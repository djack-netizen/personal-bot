<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIAMO B2B — Ad Performance Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"><\/script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0a1a;--card:rgba(255,255,255,0.04);--border:rgba(255,255,255,0.08);--text:#e4e4e7;--muted:#a1a1aa;--grad:linear-gradient(135deg,#6366f1,#3b82f6);--grad2:linear-gradient(135deg,#6366f1,#3b82f6,#00d4ff);--green:#22c55e;--red:#ef4444;--yellow:#eab308;--radius:16px;--pill:999px}
body{font-family:'Plus Jakarta Sans',Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh}
.fade-in{animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.container{max-width:1200px;margin:0 auto;padding:32px 24px}
.title-area{margin-bottom:36px;text-align:center}
.title-area h1{font-size:clamp(1.5rem,4vw,2.2rem);font-weight:800;letter-spacing:-.03em;margin-bottom:4px}
.title-area .powered{color:var(--muted);font-size:.88rem;margin-bottom:14px}
.social-pills{display:flex;gap:10px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.social-pill{display:inline-flex;align-items:center;gap:6px;border-radius:var(--pill);padding:5px 14px;font-size:.78rem;font-weight:600;border:1px solid transparent;background-origin:border-box;background-clip:padding-box,border-box;background-image:linear-gradient(var(--bg),var(--bg)),var(--grad2);color:var(--text);text-decoration:none;transition:all .25s}
.social-pill:hover{box-shadow:0 0 12px rgba(99,102,241,.3);transform:translateY(-1px)}
.social-pill svg{width:14px;height:14px;fill:currentColor}
.period-badge{display:inline-block;border-radius:var(--pill);padding:4px 14px;font-size:.75rem;color:var(--muted);border:1px solid var(--border);background:var(--card)}
.date-pills{display:flex;gap:8px}
.date-pill{border-radius:var(--pill);padding:6px 18px;font-size:.82rem;font-weight:600;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);transition:all .25s}
.date-pill:hover{border-color:rgba(99,102,241,.4);color:var(--text)}
.date-pill.active{background:var(--grad);border-color:transparent;color:#fff;box-shadow:0 0 16px rgba(99,102,241,.35)}
.kpi-row{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:36px}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);padding:22px 20px;transition:all .3s;position:relative;overflow:hidden}
.kpi-card::before{content:'';position:absolute;inset:0;border-radius:var(--radius);opacity:0;transition:opacity .3s;background:linear-gradient(135deg,rgba(99,102,241,.08),rgba(59,130,246,.06))}
.kpi-card:hover{transform:translateY(-3px);border-color:rgba(99,102,241,.25);box-shadow:0 8px 32px rgba(99,102,241,.12)}
.kpi-card:hover::before{opacity:1}
.kpi-label{font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;font-weight:600;margin-bottom:8px}
.kpi-value{font-size:1.55rem;font-weight:800;letter-spacing:-.02em;margin-bottom:2px}
.section-title{font-size:1.15rem;font-weight:700;margin-bottom:16px}
.table-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);overflow-x:auto;margin-bottom:36px}
table{width:100%;border-collapse:collapse;min-width:700px}
th{text-align:left;padding:14px 16px;font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;font-weight:600;border-bottom:1px solid var(--border)}
td{padding:14px 16px;font-size:.88rem;border-bottom:1px solid rgba(255,255,255,0.03)}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,0.02)}
td a{color:var(--text);text-decoration:none;border-bottom:1px dashed rgba(255,255,255,0.2);transition:all .2s}
td a:hover{color:#818cf8;border-bottom-color:#818cf8}
.pill{display:inline-flex;align-items:center;border-radius:var(--pill);padding:3px 12px;font-size:.73rem;font-weight:600}
.pill-active{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}
.pill-paused{background:rgba(234,179,8,.15);color:#eab308}
.chart-grid-row{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:36px}
.chart-area{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);padding:24px;position:relative}
.chart-title{font-size:1rem;font-weight:700;margin-bottom:16px}
.chart-canvas-wrap{position:relative;width:100%;height:0;padding-bottom:38%}
.chart-canvas-wrap canvas{position:absolute;top:0;left:0;width:100%!important;height:100%!important}
.footer{text-align:center;padding:24px;color:var(--muted);font-size:.8rem;border-top:1px solid var(--border)}
.footer strong{color:var(--text);font-weight:700}
.data-container{transition:opacity .3s}
.data-container.switching{opacity:0}
.loading{text-align:center;padding:60px 20px;color:var(--muted);font-size:1rem}
.loading .spinner{display:inline-block;width:32px;height:32px;border:3px solid var(--border);border-top-color:#6366f1;border-radius:50%;animation:spin .8s linear infinite;margin-bottom:12px}
@keyframes spin{to{transform:rotate(360deg)}}
.error-msg{text-align:center;padding:40px;color:var(--red);font-size:.9rem}
.view-link{display:inline-flex;align-items:center;gap:4px;color:#818cf8;font-size:.78rem;font-weight:600;text-decoration:none;transition:all .2s;white-space:nowrap}
.view-link:hover{color:#a5b4fc;text-decoration:underline}
.view-link svg{width:12px;height:12px;fill:currentColor}
@media(max-width:900px){.kpi-row{grid-template-columns:repeat(3,1fr)}.chart-grid-row{grid-template-columns:1fr}}
@media(max-width:600px){.kpi-row{grid-template-columns:1fr 1fr}.container{padding:20px 14px}.title-area h1{font-size:1.4rem}.chart-canvas-wrap{padding-bottom:50%}}
@media print{
  body{background:#fff;color:#111}
  .kpi-card,.table-wrap,.chart-area{background:#f8f8f8;border:1px solid #ddd;backdrop-filter:none;color:#111}
  .kpi-value,.section-title,.chart-title{color:#111}
  .kpi-label,.footer{color:#555}
}
</style>
</head>
<body>

<div class="container">
  <div class="title-area fade-in">
    <h1>DIAMO B2B — Ad Performance Dashboard</h1>
    <div class="powered">Powered by <strong>OPN Agency</strong></div>
    <div class="social-pills">
      <a href="https://adsmanager.facebook.com/adsmanager/manage/campaigns?act=1423348345499145" target="_blank" class="social-pill"><svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm1 17h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Ads Manager</a>
    </div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:4px;justify-content:center">
      <div class="period-badge" id="periodBadge">Loading…</div>
      <div class="date-pills">
        <div class="date-pill active" onclick="setRange(7)">7 Days</div>
        <div class="date-pill" onclick="setRange(30)">30 Days</div>
      </div>
    </div>
  </div>

  <div class="data-container" id="dataContainer">
    <div class="loading" id="loadingIndicator"><div class="spinner"></div><br>Fetching live data from Meta Ads…</div>
    <div id="mainContent" style="display:none">
      <div class="kpi-row fade-in" id="kpiRow"></div>

      <div class="section-title fade-in">Campaigns</div>
      <div class="table-wrap fade-in">
        <table>
          <thead>
            <tr><th>Campaign</th><th>Status</th><th>Spend</th><th>Impressions</th><th>Reach</th><th>Clicks</th><th>CTR</th><th>CPC</th><th>Ad Link</th></tr>
          </thead>
          <tbody id="campaignBody"></tbody>
        </table>
      </div>

      <div class="chart-grid-row fade-in">
        <div class="chart-area">
          <div class="chart-title">Daily Ad Spend</div>
          <div class="chart-canvas-wrap"><canvas id="spendChart"></canvas></div>
        </div>
        <div class="chart-area">
          <div class="chart-title">Impressions Trend</div>
          <div class="chart-canvas-wrap"><canvas id="impChart"></canvas></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  Dashboard generated by <strong>OPN Agency</strong> · Data from Meta Ads API · <span id="lastUpdated"></span>
</div>

<script>
const TOKEN = 'EAANUmV95IEABQ1YNtI7XyFaU2ZBMoK06yhaFjQd4uvEZAgK3jQk83YqrOHewbKDPYlmrlD5qzFNSvwGw6jOs1qmnv7S42nI9ZCKV2z7epO2K1lVhu5CmNZBU91XlyDKcpsBPZBKK4KZBZBzo1UodlZCzy6EgzF2BpkVyzq2n4wmLujtddBncL7GTjVKeDm8LrsFUtwZDZD';
const AD_ACCOUNT = 'act_1423348345499145';
const ADS_MGR = 'https://adsmanager.facebook.com/adsmanager/manage/campaigns?act=1423348345499145';
const API = 'https://graph.facebook.com/v21.0';

let currentRange = 7;
let spendChart, impChart;
let cachedData = {};

function fmt(n){return n.toLocaleString('en-US')}
function fmtMoney(n){return '$'+n.toFixed(2)}
function dateStr(d){return d.toISOString().split('T')[0]}
function shortDate(s){var p=s.split('-');var m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];return m[parseInt(p[1])-1]+' '+parseInt(p[2])}
function pct(n){return n.toFixed(2)+'%'}

async function fetchAPI(endpoint, params) {
  var url = API + endpoint + '?access_token=' + TOKEN;
  for (var k in params) url += '&' + k + '=' + encodeURIComponent(params[k]);
  var r = await fetch(url);
  if (!r.ok) throw new Error('API error: ' + r.status);
  return r.json();
}

async function loadData() {
  var today = new Date();
  var since30 = new Date(today); since30.setDate(since30.getDate() - 30);
  var since30Str = dateStr(since30);
  var todayStr = dateStr(today);

  try {
    var accountInsights = await fetchAPI('/' + AD_ACCOUNT + '/insights', {
      fields: 'spend,impressions,reach,clicks,ctr,cpc,actions,cost_per_action_type,video_views',
      time_range: JSON.stringify({since: since30Str, until: todayStr}),
      time_increment: 1,
      limit: 60
    });

    var since7 = new Date(today); since7.setDate(since7.getDate() - 7);
    var [agg7, agg30] = await Promise.all([
      fetchAPI('/' + AD_ACCOUNT + '/insights', {
        fields: 'spend,impressions,reach,clicks,ctr,cpc,actions,cost_per_action_type,video_views',
        time_range: JSON.stringify({since: dateStr(since7), until: todayStr})
      }),
      fetchAPI('/' + AD_ACCOUNT + '/insights', {
        fields: 'spend,impressions,reach,clicks,ctr,cpc,actions,cost_per_action_type,video_views',
        time_range: JSON.stringify({since: since30Str, until: todayStr})
      })
    ]);

    var campaigns = await fetchAPI('/' + AD_ACCOUNT + '/campaigns', {
      fields: 'name,status,id,insights.time_range(' + JSON.stringify({since: since30Str, until: todayStr}) + '){spend,impressions,reach,clicks,ctr,cpc,actions,cost_per_action_type}',
      limit: 100
    });

    var campaigns7 = await fetchAPI('/' + AD_ACCOUNT + '/campaigns', {
      fields: 'name,status,id,insights.time_range(' + JSON.stringify({since: dateStr(since7), until: todayStr}) + '){spend,impressions,reach,clicks,ctr,cpc,actions,cost_per_action_type}',
      limit: 100
    });

    cachedData = {
      daily: accountInsights.data || [],
      agg7: (agg7.data && agg7.data[0]) || {},
      agg30: (agg30.data && agg30.data[0]) || {},
      campaigns30: (campaigns.data || []),
      campaigns7: (campaigns7.data || []),
      since7: dateStr(since7),
      since30: since30Str,
      today: todayStr
    };

    document.getElementById('loadingIndicator').style.display = 'none';
    document.getElementById('mainContent').style.display = 'block';
    document.getElementById('lastUpdated').textContent = 'Last updated: ' + today.toLocaleDateString('en-US', {month:'long',day:'numeric',year:'numeric'});
    render(currentRange);
  } catch(e) {
    document.getElementById('loadingIndicator').innerHTML = '<div class="error-msg">\u26a0\ufe0f Failed to load data: ' + e.message + '<br><small>Check token validity or try refreshing.</small></div>';
  }
}

function getLeads(data) {
  if (!data.actions) return 0;
  for (var i = 0; i < data.actions.length; i++) {
    if (data.actions[i].action_type === 'lead' || data.actions[i].action_type === 'onsite_conversion.lead_grouped') return parseInt(data.actions[i].value);
  }
  return 0;
}

function getCostPerLead(data) {
  if (!data.cost_per_action_type) return null;
  for (var i = 0; i < data.cost_per_action_type.length; i++) {
    if (data.cost_per_action_type[i].action_type === 'lead' || data.cost_per_action_type[i].action_type === 'onsite_conversion.lead_grouped') return parseFloat(data.cost_per_action_type[i].value);
  }
  return null;
}

function getVideoViews(data) {
  if (data.video_views) return parseInt(data.video_views);
  if (!data.actions) return 0;
  for (var i = 0; i < data.actions.length; i++) {
    if (data.actions[i].action_type === 'video_view') return parseInt(data.actions[i].value);
  }
  return 0;
}

function setRange(r) {
  if (r === currentRange) return;
  currentRange = r;
  document.querySelectorAll('.date-pill').forEach(function(p) {
    p.classList.toggle('active', parseInt(p.textContent) === r);
  });
  var dc = document.getElementById('dataContainer');
  dc.classList.add('switching');
  setTimeout(function() { render(r); dc.classList.remove('switching'); }, 300);
}

function render(r) {
  var agg = r === 7 ? cachedData.agg7 : cachedData.agg30;
  var camps = r === 7 ? cachedData.campaigns7 : cachedData.campaigns30;
  var sinceDate = r === 7 ? cachedData.since7 : cachedData.since30;

  document.getElementById('periodBadge').textContent = shortDate(sinceDate) + ' \u2013 ' + shortDate(cachedData.today);

  var spend = parseFloat(agg.spend || 0);
  var impressions = parseInt(agg.impressions || 0);
  var reach = parseInt(agg.reach || 0);
  var clicks = parseInt(agg.clicks || 0);
  var ctr = parseFloat(agg.ctr || 0);
  var cpc = parseFloat(agg.cpc || 0);
  var leads = getLeads(agg);
  var costPerLead = getCostPerLead(agg);
  var videoViews = getVideoViews(agg);

  var kpis = [
    {label:'Total Spend',value:fmtMoney(spend)},
    {label:'Impressions',value:fmt(impressions)},
    {label:'Reach',value:fmt(reach)},
    {label:'Clicks',value:fmt(clicks)},
    {label:'CTR',value:pct(ctr)},
    {label:'CPC',value:fmtMoney(cpc)},
    {label:'Leads',value:fmt(leads)},
    {label:'Cost / Lead',value:costPerLead !== null ? fmtMoney(costPerLead) : '\u2014'},
    {label:'Video Views',value:fmt(videoViews)}
  ];
  var kpiHTML = '';
  for (var i = 0; i < kpis.length; i++) {
    kpiHTML += '<div class="kpi-card"><div class="kpi-label">' + kpis[i].label + '</div><div class="kpi-value">' + kpis[i].value + '</div></div>';
  }
  document.getElementById('kpiRow').innerHTML = kpiHTML;

  var tbody = document.getElementById('campaignBody');
  var html = '';
  var sorted = camps.slice().sort(function(a,b){
    var sa = a.insights && a.insights.data && a.insights.data[0] ? parseFloat(a.insights.data[0].spend) : 0;
    var sb = b.insights && b.insights.data && b.insights.data[0] ? parseFloat(b.insights.data[0].spend) : 0;
    return sb - sa;
  });
  for (var c = 0; c < sorted.length; c++) {
    var camp = sorted[c];
    var ins = camp.insights && camp.insights.data && camp.insights.data[0] ? camp.insights.data[0] : null;
    if (!ins) continue;
    var statusLabel = camp.status === 'ACTIVE' ? 'Active' : camp.status === 'PAUSED' ? 'Paused' : camp.status;
    var statusPill = camp.status === 'ACTIVE' ? 'pill-active' : 'pill-paused';
    var adLink = ADS_MGR + '&selected_campaign_ids=' + camp.id;
    html += '<tr><td style="font-weight:600">' + camp.name + '</td><td><span class="pill ' + statusPill + '">' + statusLabel + '</span></td><td>' + fmtMoney(parseFloat(ins.spend||0)) + '</td><td>' + fmt(parseInt(ins.impressions||0)) + '</td><td>' + fmt(parseInt(ins.reach||0)) + '</td><td>' + fmt(parseInt(ins.clicks||0)) + '</td><td>' + pct(parseFloat(ins.ctr||0)) + '</td><td>' + fmtMoney(parseFloat(ins.cpc||0)) + '</td><td><a href="' + adLink + '" target="_blank" class="view-link"><svg viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/><path d="M5 5v14h14v-7h2v7c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h7v2H5z"/></svg>View</a></td></tr>';
  }
  tbody.innerHTML = html || '<tr><td colspan="9" style="text-align:center;color:var(--muted)">No campaign data available</td></tr>';

  var daily = cachedData.daily;
  var sliced = r === 7 ? daily.slice(-7) : daily;
  var labels = [], spendData = [], impData = [];
  for (var j = 0; j < sliced.length; j++) {
    labels.push(shortDate(sliced[j].date_start));
    spendData.push(parseFloat(sliced[j].spend || 0));
    impData.push(parseInt(sliced[j].impressions || 0));
  }

  if(spendChart) spendChart.destroy();
  if(impChart) impChart.destroy();

  var gridColor = 'rgba(255,255,255,0.06)';
  var tickColor = '#a1a1aa';

  spendChart = new Chart(document.getElementById('spendChart'), {
    type:'bar',
    data:{labels:labels, datasets:[{label:'Spend ($)',data:spendData,backgroundColor:'rgba(99,102,241,0.7)',borderRadius:4,borderSkipped:false}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:tickColor,font:{size:10},maxRotation:45},grid:{display:false}},y:{ticks:{color:tickColor,callback:function(v){return '$'+v}},grid:{color:gridColor}}}}
  });

  impChart = new Chart(document.getElementById('impChart'), {
    type:'line',
    data:{labels:labels, datasets:[{label:'Impressions',data:impData,borderColor:'#6366f1',backgroundColor:'rgba(99,102,241,0.1)',fill:true,tension:.3,pointRadius:2}]},
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{ticks:{color:tickColor,font:{size:10},maxRotation:45},grid:{display:false}},y:{ticks:{color:tickColor,callback:function(v){return fmt(v)}},grid:{color:gridColor}}}}
  });
}

loadData();
<\/script>
</body>
</html>