<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Royal Restaurant — Paid Ad Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0a1a;--card:rgba(255,255,255,0.04);--border:rgba(255,255,255,0.08);--text:#e4e4e7;--muted:#a1a1aa;--grad:linear-gradient(135deg,#6366f1,#3b82f6);--grad2:linear-gradient(135deg,#6366f1,#3b82f6,#00d4ff);--green:#22c55e;--red:#ef4444;--yellow:#eab308;--radius:16px;--pill:999px}
body{font-family:'Plus Jakarta Sans',Inter,system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh}
.fade-in{animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.container{max-width:1200px;margin:0 auto;padding:32px 24px}
.title-area{margin-bottom:36px;text-align:center}
.title-area h1{font-size:clamp(1.5rem,4vw,2.2rem);font-weight:800;letter-spacing:-.03em;margin-bottom:4px}
.title-area .powered{color:var(--muted);font-size:.88rem;margin-bottom:14px}
.social-pills{display:flex;gap:10px;justify-content:center;margin-bottom:12px;flex-wrap:wrap}
.social-pill{display:inline-flex;align-items:center;gap:6px;border-radius:var(--pill);padding:5px 14px;font-size:.78rem;font-weight:600;border:1px solid transparent;background-origin:border-box;background-clip:padding-box,border-box;background-image:linear-gradient(var(--bg),var(--bg)),var(--grad2);color:var(--text);text-decoration:none;transition:all .25s}
.social-pill:hover{box-shadow:0 0 12px rgba(99,102,241,.3);transform:translateY(-1px)}
.social-pill svg{width:14px;height:14px;fill:currentColor}
.period-badge{display:inline-block;border-radius:var(--pill);padding:4px 14px;font-size:.75rem;color:var(--muted);border:1px solid var(--border);background:var(--card)}
.date-pills{display:flex;gap:8px}
.date-pill{border-radius:var(--pill);padding:6px 18px;font-size:.82rem;font-weight:600;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--muted);transition:all .25s}
.date-pill:hover{border-color:rgba(99,102,241,.4);color:var(--text)}
.date-pill.active{background:var(--grad);border-color:transparent;color:#fff;box-shadow:0 0 16px rgba(99,102,241,.35)}
.kpi-row{display:grid;grid-template-columns:repeat(6,1fr);gap:16px;margin-bottom:36px}
.kpi-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);padding:22px 20px;transition:all .3s;position:relative;overflow:hidden}
.kpi-card::before{content:'';position:absolute;inset:0;border-radius:var(--radius);opacity:0;transition:opacity .3s;background:linear-gradient(135deg,rgba(99,102,241,.08),rgba(59,130,246,.06))}
.kpi-card:hover{transform:translateY(-3px);border-color:rgba(99,102,241,.25);box-shadow:0 8px 32px rgba(99,102,241,.12)}
.kpi-card:hover::before{opacity:1}
.kpi-label{font-size:.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:.06em;font-weight:600;margin-bottom:8px}
.kpi-value{font-size:1.55rem;font-weight:800;letter-spacing:-.02em;margin-bottom:2px}
.kpi-change{font-size:.78rem;font-weight:600;margin-top:4px}
.kpi-change.up{color:#22c55e}
.kpi-change.down{color:#ef4444}
.kpi-change.neutral{color:var(--muted)}
.section-title{font-size:1.15rem;font-weight:700;margin-bottom:16px}
.table-wrap{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);overflow-x:auto;margin-bottom:36px}
table{width:100%;border-collapse:collapse;min-width:600px}
th{text-align:left;padding:14px 16px;font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;font-weight:600;border-bottom:1px solid var(--border)}
td{padding:14px 16px;font-size:.88rem;border-bottom:1px solid rgba(255,255,255,0.03)}
tr:last-child td{border-bottom:none}
tr:hover td{background:rgba(255,255,255,0.02)}
.pill{display:inline-flex;align-items:center;border-radius:var(--pill);padding:3px 12px;font-size:.73rem;font-weight:600}
.pill-active{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}
.chart-grid-row{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:36px}
.chart-area{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);backdrop-filter:blur(10px);padding:24px;position:relative}
.chart-title{font-size:1rem;font-weight:700;margin-bottom:16px}
.footer{text-align:center;padding:24px;color:var(--muted);font-size:.8rem;border-top:1px solid var(--border)}
.footer strong{color:var(--text);font-weight:700}
.data-container{transition:opacity .3s}
.data-container.switching{opacity:0}
@media(max-width:900px){.kpi-row{grid-template-columns:repeat(3,1fr)}.chart-grid-row{grid-template-columns:1fr}}
@media(max-width:600px){.kpi-row{grid-template-columns:1fr 1fr}.container{padding:20px 14px}.title-area h1{font-size:1.4rem}}
.view-link{display:inline-flex;align-items:center;gap:4px;color:#818cf8;font-size:.78rem;font-weight:600;text-decoration:none;transition:all .2s;white-space:nowrap}
.view-link:hover{color:#a5b4fc;text-decoration:underline}
.view-link svg{width:12px;height:12px;fill:currentColor}
</style>
</head>
<body>

<div class="container">
  <div class="title-area fade-in">
    <h1>Royal Restaurant Paid Ad Dashboard</h1>
    <div class="powered">Powered by <strong>OPN Agency</strong></div>
    <div class="social-pills">
      <a href="https://www.facebook.com/theroyalrestaurantva" target="_blank" class="social-pill"><svg viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>Facebook</a>
      <a href="https://www.instagram.com/royalrestaurantalx" target="_blank" class="social-pill"><svg viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>Instagram</a>
      <a href="https://www.facebook.com/ads/library/?active_status=all&ad_type=all&country=US&view_all_page_id=221545114380847" target="_blank" class="social-pill"><svg viewBox="0 0 24 24"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm1 17h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>Ad Library</a>
    </div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-top:4px;justify-content:center">
      <div class="period-badge" id="periodBadge">Feb 20 – Feb 26, 2026</div>
      <div class="date-pills">
        <div class="date-pill active" onclick="setRange(7)">7 Days</div>
        <div class="date-pill" onclick="setRange(14)">14 Days</div>
        <div class="date-pill" onclick="setRange(30)">30 Days</div>
      </div>
    </div>
  </div>

  <div class="data-container" id="dataContainer">
    <div class="kpi-row fade-in" id="kpiRow"></div>

    <div class="section-title fade-in">Active Campaigns</div>
    <div class="table-wrap fade-in">
      <table>
        <thead>
          <tr><th>Campaign</th><th>Status</th><th>Spend</th><th>Impressions</th><th>Reach</th><th>Clicks</th><th>CTR</th><th>CPC</th><th>Ad Preview</th></tr>
        </thead>
        <tbody id="campaignBody"></tbody>
      </table>
    </div>

    <div class="chart-grid-row fade-in">
      <div class="chart-area">
        <div class="chart-title">Daily Ad Spend</div>
        <canvas id="spendChart" height="200"></canvas>
      </div>
      <div class="chart-area">
        <div class="chart-title">Daily Reach</div>
        <canvas id="reachChart" height="200"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="footer">
  <div>Last Updated: <strong>Feb 27, 2026 5:00 PM UTC</strong></div>
  <div>Powered by <strong>OPN Agency</strong></div>
</div>

<script>
// Data from Meta Ads API
const KPI_DATA = {
  "7": {
    "spend": 254.15,
    "impressions": 39140,
    "clicks": 2556,
    "ctr": 6.530404,
    "cpc": 0.099433,
    "reach": 28639,
    "leads": 0,
    "video_views": 8629,
    "video_avg_time_watched": 4.0,
    "prev": {
      "spend": 162.26,
      "impressions": 24585,
      "clicks": 1115,
      "ctr": 4.535286,
      "cpc": 0.145525,
      "reach": 17973
    }
  },
  "14": {
    "spend": 416.41,
    "impressions": 63725,
    "clicks": 3671,
    "ctr": 5.76069,
    "cpc": 0.113432,
    "reach": 40633,
    "leads": 0,
    "video_views": 11316,
    "video_avg_time_watched": 4.0,
    "prev": {
      "spend": 604.04,
      "impressions": 93400,
      "clicks": 5788,
      "ctr": 6.197002,
      "cpc": 0.104361,
      "reach": 59102
    }
  },
  "30": {
    "spend": 1071.71,
    "impressions": 165074,
    "clicks": 10001,
    "ctr": 6.058495,
    "cpc": 0.10716,
    "reach": 94291,
    "leads": 0,
    "video_views": 41079,
    "video_avg_time_watched": 4.0,
    "prev": {
      "spend": 786.29,
      "impressions": 127444,
      "clicks": 9309,
      "ctr": 7.304385,
      "cpc": 0.084466,
      "reach": 71200
    }
  }
};

const CAMPAIGNS_BY_RANGE = {
  "7": [
    {
      "campaign_name": "OPN_Dinner Focus_Reels",
      "campaign_id": "0",
      "spend": 66.15,
      "impressions": 9483,
      "clicks": 791,
      "ctr": 8.341242,
      "cpc": 0.083628,
      "reach": 8623,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Cozy Decor_Reel 1",
      "campaign_id": "0",
      "spend": 67.52,
      "impressions": 10235,
      "clicks": 844,
      "ctr": 8.246214,
      "cpc": 0.08,
      "reach": 8996,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Catering Jan-Feb Offer_Static",
      "campaign_id": "0",
      "spend": 68.26,
      "impressions": 10849,
      "clicks": 342,
      "ctr": 3.152364,
      "cpc": 0.199591,
      "reach": 7416,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_PAIDAD_Happy Hour",
      "campaign_id": "0",
      "spend": 34.5,
      "impressions": 5843,
      "clicks": 385,
      "ctr": 6.589081,
      "cpc": 0.08961,
      "reach": 5035,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_RoyalRestaurant_DateNight",
      "campaign_id": "0",
      "spend": 17.72,
      "impressions": 2730,
      "clicks": 194,
      "ctr": 7.106227,
      "cpc": 0.09134,
      "reach": 2513,
      "leads": 0,
      "video_views": 0
    }
  ],
  "14": [
    {
      "campaign_name": "OPN_Dinner Focus_Reels",
      "campaign_id": "0",
      "spend": 66.15,
      "impressions": 9483,
      "clicks": 791,
      "ctr": 8.341242,
      "cpc": 0.083628,
      "reach": 8623,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Cozy Decor_Reel 1",
      "campaign_id": "0",
      "spend": 67.52,
      "impressions": 10235,
      "clicks": 844,
      "ctr": 8.246214,
      "cpc": 0.08,
      "reach": 8996,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Catering Jan-Feb Offer_Static",
      "campaign_id": "0",
      "spend": 138.33,
      "impressions": 20859,
      "clicks": 569,
      "ctr": 2.727839,
      "cpc": 0.243111,
      "reach": 12007,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Private Events_Reel_Jan 14_Top",
      "campaign_id": "0",
      "spend": 0.88,
      "impressions": 177,
      "clicks": 6,
      "ctr": 3.389831,
      "cpc": 0.146667,
      "reach": 172,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_PAIDAD_Happy Hour",
      "campaign_id": "0",
      "spend": 69.63,
      "impressions": 11251,
      "clicks": 736,
      "ctr": 6.541641,
      "cpc": 0.094606,
      "reach": 9013,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_RoyalRestaurant_DateNight",
      "campaign_id": "0",
      "spend": 73.9,
      "impressions": 11720,
      "clicks": 725,
      "ctr": 6.186007,
      "cpc": 0.101931,
      "reach": 9135,
      "leads": 0,
      "video_views": 0
    }
  ],
  "30": [
    {
      "campaign_name": "OPN_Dinner Focus_Reels",
      "campaign_id": "0",
      "spend": 66.15,
      "impressions": 9483,
      "clicks": 791,
      "ctr": 8.341242,
      "cpc": 0.083628,
      "reach": 8623,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Cozy Decor_Reel 1",
      "campaign_id": "0",
      "spend": 67.52,
      "impressions": 10235,
      "clicks": 844,
      "ctr": 8.246214,
      "cpc": 0.08,
      "reach": 8996,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_VDay_Reel 1",
      "campaign_id": "0",
      "spend": 75.91,
      "impressions": 9216,
      "clicks": 807,
      "ctr": 8.75651,
      "cpc": 0.094064,
      "reach": 7704,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Catering Jan-Feb Offer_Static",
      "campaign_id": "0",
      "spend": 225.63,
      "impressions": 33448,
      "clicks": 856,
      "ctr": 2.559196,
      "cpc": 0.263586,
      "reach": 16335,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Vday Pre-Fixe Menu",
      "campaign_id": "0",
      "spend": 140.85,
      "impressions": 22601,
      "clicks": 1737,
      "ctr": 7.685501,
      "cpc": 0.081088,
      "reach": 15055,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Private Events_Reel_Jan 14_Top",
      "campaign_id": "0",
      "spend": 49.88,
      "impressions": 8800,
      "clicks": 353,
      "ctr": 4.011364,
      "cpc": 0.141303,
      "reach": 6774,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_Music Mondays_Reel_Jan 2",
      "campaign_id": "0",
      "spend": 95.56,
      "impressions": 15031,
      "clicks": 1232,
      "ctr": 8.196394,
      "cpc": 0.077565,
      "reach": 11833,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_PAIDAD_Happy Hour",
      "campaign_id": "0",
      "spend": 148.86,
      "impressions": 23058,
      "clicks": 1503,
      "ctr": 6.518345,
      "cpc": 0.099042,
      "reach": 15715,
      "leads": 0,
      "video_views": 0
    },
    {
      "campaign_name": "OPN_RoyalRestaurant_DateNight",
      "campaign_id": "0",
      "spend": 201.35,
      "impressions": 33202,
      "clicks": 1878,
      "ctr": 5.656286,
      "cpc": 0.107215,
      "reach": 22829,
      "leads": 0,
      "video_views": 0
    }
  ]
};

const DAILY_7 = [
  {
    "date": "2026-02-21",
    "spend": 20.86,
    "impressions": 3186,
    "clicks": 165,
    "reach": 2916
  },
  {
    "date": "2026-02-22",
    "spend": 25.66,
    "impressions": 4093,
    "clicks": 186,
    "reach": 3882
  },
  {
    "date": "2026-02-23",
    "spend": 19.36,
    "impressions": 3738,
    "clicks": 150,
    "reach": 3521
  },
  {
    "date": "2026-02-24",
    "spend": 33.88,
    "impressions": 4927,
    "clicks": 283,
    "reach": 4613
  },
  {
    "date": "2026-02-25",
    "spend": 57.39,
    "impressions": 8682,
    "clicks": 623,
    "reach": 8182
  },
  {
    "date": "2026-02-26",
    "spend": 52.32,
    "impressions": 7931,
    "clicks": 655,
    "reach": 7395
  },
  {
    "date": "2026-02-27",
    "spend": 44.68,
    "impressions": 6583,
    "clicks": 494,
    "reach": 6076
  }
];
const DAILY_30 = [
  {
    "date": "2026-01-29",
    "spend": 25.43,
    "impressions": 3747,
    "clicks": 256,
    "reach": 3601
  },
  {
    "date": "2026-01-30",
    "spend": 25.83,
    "impressions": 4202,
    "clicks": 286,
    "reach": 3972
  },
  {
    "date": "2026-01-31",
    "spend": 25.14,
    "impressions": 4415,
    "clicks": 292,
    "reach": 4178
  },
  {
    "date": "2026-02-01",
    "spend": 28.32,
    "impressions": 5072,
    "clicks": 319,
    "reach": 4693
  },
  {
    "date": "2026-02-02",
    "spend": 43.42,
    "impressions": 7680,
    "clicks": 509,
    "reach": 7032
  },
  {
    "date": "2026-02-03",
    "spend": 45.19,
    "impressions": 7508,
    "clicks": 526,
    "reach": 6823
  },
  {
    "date": "2026-02-04",
    "spend": 43.45,
    "impressions": 6841,
    "clicks": 556,
    "reach": 6469
  },
  {
    "date": "2026-02-05",
    "spend": 59.84,
    "impressions": 8697,
    "clicks": 666,
    "reach": 7996
  },
  {
    "date": "2026-02-06",
    "spend": 75.1,
    "impressions": 10828,
    "clicks": 773,
    "reach": 9742
  },
  {
    "date": "2026-02-07",
    "spend": 68.67,
    "impressions": 10116,
    "clicks": 579,
    "reach": 9251
  },
  {
    "date": "2026-02-08",
    "spend": 70.66,
    "impressions": 9893,
    "clicks": 584,
    "reach": 9028
  },
  {
    "date": "2026-02-09",
    "spend": 43.13,
    "impressions": 6359,
    "clicks": 373,
    "reach": 5922
  },
  {
    "date": "2026-02-10",
    "spend": 26.08,
    "impressions": 3798,
    "clicks": 166,
    "reach": 3414
  },
  {
    "date": "2026-02-11",
    "spend": 24.94,
    "impressions": 3999,
    "clicks": 161,
    "reach": 3640
  },
  {
    "date": "2026-02-12",
    "spend": 25.35,
    "impressions": 4314,
    "clicks": 133,
    "reach": 3984
  },
  {
    "date": "2026-02-13",
    "spend": 24.75,
    "impressions": 3880,
    "clicks": 151,
    "reach": 3501
  },
  {
    "date": "2026-02-14",
    "spend": 22.45,
    "impressions": 3707,
    "clicks": 131,
    "reach": 3430
  },
  {
    "date": "2026-02-15",
    "spend": 25.89,
    "impressions": 3814,
    "clicks": 169,
    "reach": 3513
  },
  {
    "date": "2026-02-16",
    "spend": 24.74,
    "impressions": 3779,
    "clicks": 158,
    "reach": 3592
  },
  {
    "date": "2026-02-17",
    "spend": 22.18,
    "impressions": 3432,
    "clicks": 160,
    "reach": 3245
  },
  {
    "date": "2026-02-18",
    "spend": 22.6,
    "impressions": 3256,
    "clicks": 150,
    "reach": 3084
  },
  {
    "date": "2026-02-19",
    "spend": 23.17,
    "impressions": 3468,
    "clicks": 176,
    "reach": 3337
  },
  {
    "date": "2026-02-20",
    "spend": 21.23,
    "impressions": 3129,
    "clicks": 171,
    "reach": 3032
  },
  {
    "date": "2026-02-21",
    "spend": 20.86,
    "impressions": 3186,
    "clicks": 165,
    "reach": 2916
  },
  {
    "date": "2026-02-22",
    "spend": 25.66,
    "impressions": 4093,
    "clicks": 186,
    "reach": 3882
  },
  {
    "date": "2026-02-23",
    "spend": 19.36,
    "impressions": 3738,
    "clicks": 150,
    "reach": 3521
  },
  {
    "date": "2026-02-24",
    "spend": 33.88,
    "impressions": 4927,
    "clicks": 283,
    "reach": 4613
  },
  {
    "date": "2026-02-25",
    "spend": 57.39,
    "impressions": 8682,
    "clicks": 623,
    "reach": 8182
  },
  {
    "date": "2026-02-26",
    "spend": 52.32,
    "impressions": 7931,
    "clicks": 655,
    "reach": 7395
  },
  {
    "date": "2026-02-27",
    "spend": 44.68,
    "impressions": 6583,
    "clicks": 494,
    "reach": 6076
  }
];

let currentRange = 7;
let spendChart, reachChart;

function formatNumber(num) {
  if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
  if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
  return num.toLocaleString();
}

function formatCurrency(amount) {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 2
  }).format(amount);
}

function getChangeClass(current, previous) {
  if (current > previous) return 'up';
  if (current < previous) return 'down';
  return 'neutral';
}

function getChangeText(current, previous) {
  if (previous === 0) return current > 0 ? '+100%' : '0%';
  const change = ((current - previous) / previous * 100);
  return (change >= 0 ? '+' : '') + change.toFixed(1) + '%';
}

function updateKPIs() {
  const data = KPI_DATA[currentRange];
  const prev = data.prev;

  const kpis = [
    {
      label: 'Total Spend',
      value: formatCurrency(data.spend),
      change: getChangeText(data.spend, prev.spend),
      changeClass: getChangeClass(data.spend, prev.spend)
    },
    {
      label: 'Impressions',
      value: formatNumber(data.impressions),
      change: getChangeText(data.impressions, prev.impressions),
      changeClass: getChangeClass(data.impressions, prev.impressions)
    },
    {
      label: 'Clicks',
      value: formatNumber(data.clicks),
      change: getChangeText(data.clicks, prev.clicks),
      changeClass: getChangeClass(data.clicks, prev.clicks)
    },
    {
      label: 'CTR',
      value: data.ctr.toFixed(2) + '%',
      change: getChangeText(data.ctr, prev.ctr),
      changeClass: getChangeClass(data.ctr, prev.ctr)
    },
    {
      label: 'CPC',
      value: formatCurrency(data.cpc),
      change: getChangeText(data.cpc, prev.cpc),
      changeClass: getChangeClass(prev.cpc, data.cpc) // Lower CPC is better
    },
    {
      label: 'Reach',
      value: formatNumber(data.reach),
      change: getChangeText(data.reach, prev.reach),
      changeClass: getChangeClass(data.reach, prev.reach)
    }
  ];

  document.getElementById('kpiRow').innerHTML = kpis.map(kpi => `
    <div class="kpi-card">
      <div class="kpi-label">${kpi.label}</div>
      <div class="kpi-value">${kpi.value}</div>
      <div class="kpi-change ${kpi.changeClass}">${kpi.change}</div>
    </div>
  `).join('');
}

function updateCampaigns() {
  const campaigns = CAMPAIGNS_BY_RANGE[currentRange] || [];

  document.getElementById('campaignBody').innerHTML = campaigns.map(campaign => `
    <tr>
      <td>${campaign.campaign_name}</td>
      <td><span class="pill pill-active">Active</span></td>
      <td>${formatCurrency(campaign.spend)}</td>
      <td>${formatNumber(campaign.impressions)}</td>
      <td>${formatNumber(campaign.reach)}</td>
      <td>${formatNumber(campaign.clicks)}</td>
      <td>${campaign.ctr.toFixed(2)}%</td>
      <td>${formatCurrency(campaign.cpc)}</td>
      <td><a href="https://www.facebook.com/ads/library/?active_status=all&ad_type=all&country=US&search_type=keyword_unordered&q=${encodeURIComponent(campaign.campaign_name)}" target="_blank" class="view-link"><svg viewBox="0 0 24 24"><path d="M14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/><path d="M5 5v14h14v-7h2v7c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h7v2H5z"/></svg>View</a></td>
    </tr>
  `).join('');
}

function updateCharts() {
  const dailyData = currentRange === 7 ? DAILY_7 : DAILY_30;
  const labels = dailyData.map(day => new Date(day.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

  // Destroy existing charts
  if (spendChart) spendChart.destroy();
  if (reachChart) reachChart.destroy();

  // Spend Chart
  spendChart = new Chart(document.getElementById('spendChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Daily Spend',
        data: dailyData.map(day => day.spend),
        borderColor: '#6366f1',
        backgroundColor: 'rgba(99, 102, 241, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(255,255,255,0.1)' },
          ticks: {
            color: '#a1a1aa',
            callback: function(value) { return '$' + value; }
          }
        },
        x: {
          grid: { color: 'rgba(255,255,255,0.1)' },
          ticks: { color: '#a1a1aa' }
        }
      }
    }
  });

  // Reach Chart
  reachChart = new Chart(document.getElementById('reachChart'), {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Daily Reach',
        data: dailyData.map(day => day.reach),
        borderColor: '#22c55e',
        backgroundColor: 'rgba(34, 197, 94, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(255,255,255,0.1)' },
          ticks: {
            color: '#a1a1aa',
            callback: function(value) { return formatNumber(value); }
          }
        },
        x: {
          grid: { color: 'rgba(255,255,255,0.1)' },
          ticks: { color: '#a1a1aa' }
        }
      }
    }
  });
}

function updatePeriodBadge() {
  const badges = {
    7: 'Feb 20 – Feb 26, 2026',
    14: 'Feb 13 – Feb 26, 2026',
    30: 'Jan 28 – Feb 26, 2026'
  };
  document.getElementById('periodBadge').textContent = badges[currentRange];
}

function setRange(range) {
  currentRange = range;

  // Update active pill
  document.querySelectorAll('.date-pill').forEach(pill => pill.classList.remove('active'));
  document.querySelector(`[onclick="setRange(${range})"]`).classList.add('active');

  // Update data
  updatePeriodBadge();
  updateKPIs();
  updateCampaigns();
  updateCharts();
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
  setRange(7);
});
</script>
</body>
</html>